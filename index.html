<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²·å®¶æ•…äº‹é€±ï¼šè®“ä½ çš„æ•…äº‹å½±éŸ¿ä¸‹ä¸€å€‹è²·å®¶ï¼</title>
    <link rel="stylesheet" href="style.css"> 
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>

    <header class="navbar">
        <div class="logo">è¦çš® Shopee</div>
        <nav>
            <a href="#rules">æ´»å‹•ç©æ³•</a>
            <a href="#wall">æ•…äº‹ç‰†</a>
            <a href="#" onclick="openModal(); return false;">åˆ†äº«æ•…äº‹</a> 
            <a href="#rewards">æœ¬é€±çå‹µ</a>
        </nav>
    </header>

    <section class="hero-section">
        <h1>è²·å®¶æ•…äº‹é€±ï¼šè²·è±¹ï¼</h1>
        <h2>è®“ä½ çš„çœŸå¯¦æ•…äº‹ï¼Œä¸²èµ·è²·å®¶ä¹‹é–“çš„å…±é³´èˆ‡ä¿¡ä»»ã€‚</h2>
        <a href="#" class="cta-button" onclick="openModal(); return false;">ç«‹å³åˆ†äº«æˆ‘çš„æ•…äº‹ â†’</a>
    </section>

    <section id="rules" class="rules-section">
        <h3>ğŸ’¡ æœ¬é€±ä¸»é¡Œï¼šã€æœ€å¯¦ç”¨çš„æ”¹é€ å¥½ç‰©ã€‘</h3>
        <div class="rule-steps">
            <div class="step">
                <h4>STEP 1. æ‹ç…§/éŒ„å½±</h4>
                <p>ä¸Šå‚³ä½ çš„å•†å“ç…§ç‰‡æˆ–çŸ­å½±éŸ³ã€‚</p>
            </div>
            <div class="step">
                <h4>STEP 2. æ’°å¯«æ•…äº‹ (#MyshopeeStory)</h4>
                <p>çŸ­æ–‡æè¿°é€™é …å•†å“å¦‚ä½•è®“ä½ çš„ç”Ÿæ´»è®Šæ›´å¥½ã€‚</p>
            </div>
            <div class="step">
                <h4>STEP 3. æŠ•ç¥¨æ±ºå®š (é€±æœ«)</h4>
                <p>æ¯å€‹é€±æœ«ï¼Œé¸å‡ºæœ€å¸å¼•ä½ çš„å•†å“æ•…äº‹ï¼Œå°±æœ‰æ©Ÿæœƒç²å¾—è¦å¹£ï¼</p>
            </div>
        </div>
        <p class="date-info">æ´»å‹•æ™‚é–“ï¼šæ¯é€±ä¸€è‡³é€±äº”æŠ•ç¨¿ï¼›é€±å…­ã€é€±æ—¥æŠ•ç¥¨ã€‚</p>
    </section>

    <section id="wall" class="story-wall">
        <h3>â­ï¸ è²·å®¶æ•…äº‹ç‰†ï¼šæœ¬é€±äººæ°£ç²¾é¸</h3>
        <p style="color: #FF6600; font-weight: bold; margin-bottom: 20px;">ğŸ”¥ å³æ™‚æˆ°æ³ Live</p>
        <div class="story-grid" id="story-container">
            </div>
        <a href="#" class="view-all">æŸ¥çœ‹æ›´å¤šæ•…äº‹ â†’</a>
    </section>

    <section id="submit" class="cta-section">
        <h3>æƒ³è¢«çœ‹è¦‹ï¼Ÿç«‹å³æˆç‚ºæ•…äº‹ä¸»è§’ï¼</h3>
        <p>ä½ çš„åˆ†äº«ï¼Œå°‡ç‚ºåƒè¬è²·å®¶å¸¶ä¾†ä¿¡å¿ƒèˆ‡å…±é³´ã€‚é‚„æœ‰æ©Ÿæœƒç²å¾—é«˜é¡è¦å¹£èˆ‡å°ˆå±¬æ›å…‰ï¼</p>
        <a href="#" class="submit-button" onclick="openModal(); return false;">å‰å¾€è¦çš® App æŠ•ç¨¿</a>
    </section>

    <footer class="footer">
        <p>Â© è¦çš®-è²·å®¶æ•…äº‹é€±ä¼åŠƒ | è¯ç¹«æˆ‘å€‘</p>
    </footer>

    <div id="submission-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h3>åˆ†äº«ä½ çš„ #MyshopeeStory</h3>
            <p>è®“æˆ‘å€‘ä¸€èµ·ç”¨æ•…äº‹å½±éŸ¿ä¸‹ä¸€å€‹è²·å®¶ï¼</p>
            
            <form id="story-form">
                <div class="form-group">
                    <label for="story-title">æ•…äº‹æ¨™é¡Œ (å¦‚ï¼šã€å¯¦ç”¨ã€‘ç§Ÿå±‹æ—å¿…å‚™ï¼)</label>
                    <input type="text" id="story-title" required maxlength="30" value="ã€æ¨è–¦ã€‘é€™æ¬¾æ”¹é€ ç¥å™¨å¤ªå¼·äº†ï¼">
                </div>
                <div class="form-group">
                    <label for="story-author">ä½ çš„æš±ç¨±</label>
                    <input type="text" id="story-author" required maxlength="15" value="è¦çš®æ„›ç”¨è€…å°æ˜">
                </div>
                <div class="form-group">
                    <label for="product-link">â­ å•†å“é€£çµç¶²å€</label>
                    <input type="url" id="product-link" value="https://shopee.tw/product-demo" required>
                </div>
                
                <div class="form-group">
                    <label>ç…§ç‰‡/å½±ç‰‡é è¦½</label>
                    <div style="margin-bottom: 10px; border: 2px dashed #ff6600; border-radius: 8px; padding: 5px; background: #fff5f0;">
                        <img id="preview-img" src="A1.jpg" 
                             alt="é è¦½åœ–" 
                             style="width: 100%; height: auto; border-radius: 4px; display: block;">
                    </div>
                    <label for="story-media" style="font-size: 0.9rem; color: #666;">æ›´æ›ç…§ç‰‡ (é¸å¡«)ï¼š</label>
                    <input type="file" id="story-media" accept="image/*,video/*">
                </div>
                
                <div class="form-group">
                    <label for="story-text">ä½ çš„æ•…äº‹å…§æ–‡</label>
                    <textarea id="story-text" rows="4" required>åŸæœ¬ç§Ÿå±‹è™•çš„ç‰†å£å¾ˆèˆŠï¼Œè²¼ä¸Šé€™å€‹å£ç´™å¾Œæ•´å€‹ç…¥ç„¶ä¸€æ–°ï¼Œæ¯å¤©å›å®¶å¿ƒæƒ…éƒ½è¶…å¥½ï¼å¤§æ¨ï¼</textarea>
                </div>
                
                <button type="submit" class="submit-story-btn">æŠ•ç¨¿ä¸¦ç™¼ä½ˆ</button>
            </form>
            <p class="note">æ³¨æ„ï¼šç‚ºæ±‚æ¼”ç¤ºæ•ˆæœï¼ŒæŠ•ç¨¿å°‡æš«æ™‚å­˜æ–¼æœ¬åœ°ï¼Œé‡æ–°æ•´ç†å¾Œæ¶ˆå¤±ã€‚</p>
        </div>
    </div>
    
    <script>
        // ==========================================
        //  2. è¨­å®š Firebase (è«‹åœ¨æ­¤è™•è²¼ä¸Šä½ çš„ Config)
        // ==========================================
        
        // ğŸš¨ è«‹åˆªé™¤ä¸‹æ–¹çš„è¨»è§£ç¯„ä¾‹ï¼Œè²¼ä¸Šä½ åœ¨ Firebase Console è¤‡è£½çš„é‚£ä¸€å¤§æ®µç¨‹å¼ç¢¼
        const firebaseConfig = {
  apiKey: "AIzaSyA3V2vuHLxLwmtJSzYqUbiy-fhOsGpu8xE",
  authDomain: "shopeestory-9671d.firebaseapp.com",
  databaseURL: "https://shopeestory-9671d-default-rtdb.firebaseio.com",
  projectId: "shopeestory-9671d",
  storageBucket: "shopeestory-9671d.firebasestorage.app",
  messagingSenderId: "1052137917692",
  appId: "1:1052137917692:web:7c42f5b181d44595749b79",
  measurementId: "G-YXN4DKLDGN"
};

        // åˆå§‹åŒ– Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // ==========================================
        //  3. æ•…äº‹åŸºç¤è³‡æ–™ (éœæ…‹éƒ¨åˆ†)
        // ==========================================
        // é€™äº›è³‡æ–™æ˜¯å›ºå®šçš„ï¼Œä½†ç¥¨æ•¸æœƒå¾ Firebase æŠ“å–
        const storiesStaticData = [ 
            { id: 1, title: "ã€çˆ†ç¬‘ã€‘æˆ‘çš„æ‡¶äººæ²™ç™¼æ­·éšªè¨˜", author: "è²·åˆ°ç¡è‘—çš„Yiling", imageUrl: "A1.jpg", productLink: "#" },
            { id: 2, title: "ã€æ„Ÿäººã€‘ç‚ºåª½åª½æ›ä¸Šçš„æº«æš–æª¯ç‡ˆ", author: "å­é †å°å¹«æ‰‹Gary", imageUrl: "A2.jpg", productLink: "#" },
            { id: 3, title: "ã€å¯¦ç”¨ã€‘ç§Ÿå±‹æ—å¿…å‚™ï¼æ”¶ç´å±¤æ¶", author: "ç©ºé–“é­”è¡“å¸«Anna", imageUrl: "A3.jpg", productLink: "#" },
            { id: 4, title: "å¾æ­¤å‘Šåˆ¥å¡µèŸï¼é™¤æ¿•æ©Ÿé–‹ç®±", author: "éæ•å…’æ•‘æ˜ŸKevin", imageUrl: "A4.jpg", productLink: "#" },
            { id: 5, title: "ä¸€ç§’è®Šç¶²ç¾ï¼é«˜CPå€¼æ‰“å…‰ç‡ˆ", author: "è‡ªæ‹å¥³ç‹Dora", imageUrl: "A5.jpg", productLink: "#" },
            { id: 6, title: "è²“å¥´å¿…çœ‹ï¼è®“ä¸»å­ç˜‹ç‹‚çš„ç©å…·", author: "è²“æŒæ«ƒLeo", imageUrl: "A6.jpg", productLink: "#" },
            { id: 7, title: "ç•°æ˜Ÿæ©Ÿæ¢°éµç›¤ï¼å¸¥åˆ°æ²’æœ‹å‹", author: "é›»ç«¶é˜¿è±ª", imageUrl: "A7.jpg", productLink: "#" } 
        ];

        // ==========================================
        //  4. æ¸²æŸ“é é¢èˆ‡å³æ™‚ç›£è½
        // ==========================================
        const container = document.getElementById('story-container');

        // é¦–æ¬¡æ¸²æŸ“å¡ç‰‡ (ç¥¨æ•¸å…ˆé¡¯ç¤ºã€Œè¼‰å…¥ä¸­...ã€)
        function initRender() {
            container.innerHTML = '';
            storiesStaticData.forEach(story => {
                const storyCardHtml = `
                    <div class="story-card" id="card-${story.id}">
                        <a href="${story.productLink}" target="_blank">
                            <img src="${story.imageUrl}" alt="${story.title}" onerror="this.onerror=null;this.src='https://via.placeholder.com/300x200?text=Image'">
                        </a>
                        <h4>${story.title}</h4>
                        <p class="author">@${story.author}</p>
                        <div class="votes">
                            <span class="vote-count" id="vote-text-${story.id}">è¼‰å…¥ä¸­...</span>
                            <button class="vote-btn" onclick="submitVote(${story.id})">æŠ•ç¥¨</button>
                        </div>
                    </div>
                `;
                container.innerHTML += storyCardHtml;
            });
        }

        // ç›£è½ Firebase è³‡æ–™åº«è®Šå‹• (é€™æ˜¯å¯¦ç¾ Real-time çš„æ ¸å¿ƒï¼)
        // åªè¦è³‡æ–™åº«æœ‰è®Šå‹•ï¼Œé€™è£¡å°±æœƒæ”¶åˆ°é€šçŸ¥ï¼Œä¸ç”¨é‡æ–°æ•´ç†ç¶²é 
        db.ref('votes').on('value', (snapshot) => {
            const votesData = snapshot.val() || {}; // ç²å–æ‰€æœ‰ç¥¨æ•¸è³‡æ–™

            // æ›´æ–°æ¯ä¸€å€‹æ•…äº‹çš„ç¥¨æ•¸é¡¯ç¤º
            storiesStaticData.forEach(story => {
                const count = votesData[story.id] || 0; // å¦‚æœæ²’è³‡æ–™å°±é è¨­ç‚º 0
                const voteElement = document.getElementById(`vote-text-${story.id}`);
                if (voteElement) {
                    voteElement.innerText = `${count.toLocaleString()} ç¥¨`;
                    // å¢åŠ ä¸€å€‹é–ƒçˆå‹•ç•«æ•ˆæœï¼Œè®“ç”¨æˆ¶çŸ¥é“æ•¸å­—è®Šäº†
                    voteElement.style.color = "#FF0000";
                    setTimeout(() => voteElement.style.color = "#FF6600", 300);
                }
            });

            // (é€²éš) é€™è£¡å¯ä»¥å¯«é‚è¼¯è®“å¡ç‰‡æ ¹æ“šç¥¨æ•¸é‡æ–°æ’åºï¼Œä½†ç‚ºäº†é¿å…ç•«é¢ä¸€ç›´è·³å‹•ï¼Œæš«æ™‚ä¸åŠ 
        });

        // åŸ·è¡Œåˆå§‹åŒ–æ¸²æŸ“
        initRender();

        // ==========================================
        //  5. æŠ•ç¥¨åŠŸèƒ½ (å¯«å…¥ Firebase)
        // ==========================================
        function submitVote(storyId) {
            // ä½¿ç”¨ transaction ç¢ºä¿å¤šäººåŒæ™‚é»æ“Šæ™‚ç¥¨æ•¸ä¸æœƒç®—éŒ¯
            const voteRef = db.ref('votes/' + storyId);
            
            voteRef.transaction((current_value) => {
                return (current_value || 0) + 1; // ç¥¨æ•¸ +1
            }, (error, committed, snapshot) => {
                if (error) {
                    console.error('æŠ•ç¥¨å¤±æ•—', error);
                } else if (committed) {
                    // é€™è£¡å¯ä»¥åŠ ä¸€äº›ä½¿ç”¨è€…çš„æœ¬åœ°å›é¥‹ï¼Œä¾‹å¦‚æŒ‰éˆ•è®Šè‰²
                    // alert('æŠ•ç¥¨æˆåŠŸï¼'); // ç‚ºäº†æµæš¢é«”é©—ï¼Œé€šå¸¸ä¸è·³alert
                }
            });
        }

        // ==========================================
        //  6. æŠ•ç¨¿ Modal é‚è¼¯ (ç¶­æŒåŸæ¨£ï¼Œä½†åŠ ä¸Šåœ–ç‰‡è¼ªæ’­)
        // ==========================================
        const modal = document.getElementById('submission-modal');
        const form = document.getElementById('story-form');
        const previewImg = document.getElementById('preview-img');
        const demoImages = ['A1.jpg', 'A2.jpg', 'A3.jpg', 'A4.jpg', 'A5.jpg', 'A6.jpg', 'A7.jpg'];
        let currentImgIndex = 0;

        function openModal() {
            previewImg.src = demoImages[currentImgIndex];
            currentImgIndex = (currentImgIndex + 1) % demoImages.length;
            modal.style.display = 'block';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                closeModal();
            }
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault(); 
            // æ¼”ç¤ºç”¨ï¼šé€™è£¡æš«æ™‚ä¸å¯«å…¥è³‡æ–™åº«ï¼Œåªé¡¯ç¤ºæˆåŠŸ
            const author = document.getElementById('story-author').value.trim();
            alert(`æ­å–œ @${author}ï¼æ‚¨çš„æ•…äº‹å·²é€å‡º (æ¼”ç¤ºæ¨¡å¼)ï¼`);
            closeModal();
        });

        // åœ–ç‰‡é è¦½åŠŸèƒ½
        document.getElementById('story-media').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if(file){
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        });

    </script>
</body>
</html>